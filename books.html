<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="books.css">
    <title>Книжная полка</title>
</head>
<body>
    <div class="intro" id="intro">
        <img src="https://graph.org/file/2c60cf9861f79faf63b96.jpg" alt="Intro Avatar" class="intro-avatar">
    </div>

    <div class="container" id="mainContainer">
        <header class="header">
            <div class="genre-select" id="genreSelect">Выбор Жанра</div>
            <div class="menu-icon" id="menuIcon">&#8942;</div>
        </header>
        <main class="books-container" id="booksContainer"></main>
    </div>

    <div id="menuModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <button class="modal-button" id="donatButton">Donat</button>
            <button class="modal-button" id="telegramButton">Telegram</button>
        </div>
    </div>

    <div id="donatModal" class="donat-modal">
        <div class="donat-content">
            <img src="https://graph.org/file/2c60cf9861f79faf63b96.jpg" alt="Bank Avatar" class="bank-avatar">
            <div class="copy-text" id="copyText">2200700811767465</div>
            <p class="copy-hint">Нажмите, чтобы скопировать</p>
        </div>
    </div>

    <div id="genreModal" class="genre-modal">
        <div class="genre-modal-content">
            <span class="close">&times;</span>
            <img src="https://graph.org/file/2c60cf9861f79faf63b96.jpg" alt="Genre Avatar" class="genre-avatar">
            <div id="genreButtons" class="genre-buttons"></div>
        </div>
    </div>

    <script>
        // Existing code...

        // New code for genre modal
        const genreModal = document.getElementById('genreModal');
        const genreButtons = document.getElementById('genreButtons');
        const mainContainer = document.getElementById('mainContainer');

        genreSelect.onclick = function() {
            genreModal.style.display = 'block';
            mainContainer.classList.add('blur');
        }

        async function populateGenreButtons() {
            const books = await loadBooks();
            const genres = new Set();
            books.forEach(book => book.genres.forEach(genre => genres.add(genre)));
            
            genres.forEach(genre => {
                const button = document.createElement('button');
                button.className = 'genre-button';
                button.textContent = genre;
                button.onclick = function() {
                    filterBooksByGenre(genre);
                    genreModal.style.display = 'none';
                    mainContainer.classList.remove('blur');
                };
                genreButtons.appendChild(button);
            });
        }

        window.onclick = function(event) {
            if (event.target == menuModal) {
                menuModal.style.display = 'none';
            }
            if (event.target == donatModal) {
                donatModal.style.display = 'none';
            }
            if (event.target == genreModal) {
                genreModal.style.display = 'none';
                mainContainer.classList.remove('blur');
            }
        }

        // Call this function after books are loaded
        populateGenreButtons();

        // Modify the existing filterBooksByGenre function
        async function filterBooksByGenre(genre) {
            const books = await loadBooks();
            const filteredBooks = books.filter(book => book.genres.includes(genre));
            const booksContainer = document.getElementById('booksContainer');
            booksContainer.innerHTML = '';  // Clear the container
            
            filteredBooks.forEach((book, index) => {
                if (index % 2 === 0) {
                    const row = document.createElement('div');
                    row.className = 'books-row';
                    row.style.display = 'flex';
                    row.style.justifyContent = 'space-between';
                    row.style.marginBottom = '30px';
                    booksContainer.appendChild(row);
                }

                const bookBlock = createBookBlock(book);
                booksContainer.lastChild.appendChild(bookBlock);
            });
        }

        // Rest of the existing code...
    </script>
</body>
</html>