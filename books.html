<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="books.css">
    <link rel="icon" href="book.ico" type="image/x-icon">
    <title>Книжная полка</title>
    <style>
        /* Existing styles */
        /* ... (keep your existing styles) ... */

        /* New styles for image loading */
        .book-image-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 150%; /* Adjust based on your image aspect ratio */
            background-color: #f0f0f0;
            overflow: hidden;
        }

        .book-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .loading-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 0%;
            height: 4px;
            background-color: #4CAF50;
            transition: width 0.3s ease-in-out;
        }

        .book-link {
            text-decoration: none;
            color: inherit;
            display: block;
        }
    </style>
</head>
<body>
    <!-- Keep your existing HTML structure -->
    <!-- ... -->

    <script>
        // Existing functions (loadBooks, displayBooks, etc.)
        // ...

        function createBookBlock(book) {
            const bookBlock = document.createElement('div');
            bookBlock.className = 'book-block';

            const genresHTML = book.genres.map(genre => 
                `<span class="book-genre">${genre}</span>`
            ).join('');

            bookBlock.innerHTML = `
                <a href="${book.link}" class="book-link" target="_blank">
                    <div class="book-image-container">
                        <div class="loading-bar"></div>
                        <img src="${book.image}" alt="${book.title}" class="book-image">
                    </div>
                    <div class="book-info">
                        <h2 class="book-title">${book.title}</h2>
                        <div class="book-genres">${genresHTML}</div>
                    </div>
                </a>
            `;

            const img = bookBlock.querySelector('.book-image');
            const loadingBar = bookBlock.querySelector('.loading-bar');

            img.onload = function() {
                loadingBar.style.width = '100%';
                setTimeout(() => {
                    img.style.opacity = '1';
                    loadingBar.style.opacity = '0';
                }, 300);
            };

            img.onerror = function() {
                loadingBar.style.backgroundColor = '#FF0000';
                loadingBar.style.width = '100%';
            };

            // Simulate loading progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress > 90) {
                    clearInterval(interval);
                } else {
                    loadingBar.style.width = `${progress}%`;
                }
            }, 100);

            return bookBlock;
        }

        // Keep your existing event listeners and other functions
        // ...

    </script>
</body>
</html>